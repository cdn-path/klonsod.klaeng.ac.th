<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏≠‡∏ô‡∏™‡∏î "‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏ô‡∏ó‡πå ‡∏™‡∏∑‡∏ö‡∏™‡∏≤‡∏ô‡∏ß‡∏£‡∏£‡∏ì‡∏®‡∏¥‡∏•‡∏õ‡πå ‡∏ñ‡∏¥‡πà‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏Å‡∏•‡∏á" ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF69B4',
                        secondary: '#FFD700',
                        accent: '#00FF7F',
                    },
                    fontFamily: {
                        fun: ['"Prompt"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .toast-enter {
            animation: slideIn 0.3s ease-out;
        }
        .toast-exit {
            animation: slideOut 0.3s ease-in;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #FF69B4;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-pink-100 to-yellow-100 min-h-screen p-2 sm:p-4 font-fun">
    <div id="toast-container" class="fixed top-2 right-2 sm:top-4 sm:right-4 z-50 space-y-2 sm:space-y-3 max-w-[calc(100vw-1rem)] sm:max-w-md"></div>

    <div class="max-w-7xl mx-auto mb-3 sm:mb-6">
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg p-1.5 sm:p-2 flex gap-1.5 sm:gap-2">
            <button id="tab-form" onclick="switchTab('form')" 
                class="flex-1 py-2.5 sm:py-3 px-3 sm:px-6 rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg transition-all duration-300 bg-primary text-white">
                üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
            </button>
            <button id="tab-list" onclick="switchTab('list')" 
                class="flex-1 py-2.5 sm:py-3 px-3 sm:px-6 rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg transition-all duration-300 bg-gray-100 text-gray-600 hover:bg-gray-200">
                üìä ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
            </button>
        </div>
    </div>

    <div id="form-section" class="max-w-3xl mx-auto">
        <div class="w-full bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-10 border-2 sm:border-4 border-dashed border-primary">
            <h1 class="text-xl sm:text-2xl md:text-4xl font-bold text-center mb-6 sm:mb-10 text-primary">
                <span class="inline-block animate-bounce">‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏≠‡∏ô‡∏™‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞! üéâ</span>
                <br>
                <span class="text-base sm:text-lg md:text-2xl block mt-2">"‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏ô‡∏ó‡πå ‡∏™‡∏∑‡∏ö‡∏™‡∏≤‡∏ô‡∏ß‡∏£‡∏£‡∏ì‡∏®‡∏¥‡∏•‡∏õ‡πå ‡∏ñ‡∏¥‡πà‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏Å‡∏•‡∏á"</span>
                <br>
                <span class="text-sm sm:text-base md:text-xl">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 5 ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568</span>
            </h1>

            <div class="mb-6 sm:mb-10">
                <div class="flex justify-between mb-2 sm:mb-3">
                    <span class="text-xs sm:text-md font-bold text-accent">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô üöÄ</span>
                    <span class="text-xs sm:text-md font-bold text-accent">‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à üèÜ</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 sm:h-4">
                    <div id="progress-bar"
                        class="bg-gradient-to-r from-primary to-accent h-3 sm:h-4 rounded-full transition-all duration-500"
                        style="width: 20%"></div>
                </div>
            </div>

            <form id="registration-form" class="space-y-6 sm:space-y-10">
                <div id="step-1" class="step">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 text-secondary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô üòä</h2>
                    <div class="space-y-4 sm:space-y-6">
                        <div>
                            <label for="email" class="block text-base sm:text-lg font-medium text-gray-800">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üìß</label>
                            <input type="email" id="email" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="school" class="block text-base sm:text-lg font-medium text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                <span class="text-sm text-gray-500">(‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</span></label>
                            <input type="text" id="school" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="province" class="block text-base sm:text-lg font-medium text-gray-800">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                                <span class="text-sm text-gray-500">(‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)</span></label>
                            <input type="text" id="province" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="level" class="block text-base sm:text-lg font-medium text-gray-800">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô üèÖ</label>
                            <select id="level" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏•‡∏¢!</option>
                                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô</option>
                                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="step-2" class="step hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 text-secondary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏à‡πã‡∏á üåü</h2>
                    <div class="space-y-4 sm:space-y-6">
                        <div>
                            <label for="contestant1" class="block text-base sm:text-lg font-medium text-gray-800">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1
                                <span class="text-sm text-gray-500">(‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)</span></label>
                            <input type="text" id="contestant1" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="contestant2" class="block text-base sm:text-lg font-medium text-gray-800">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 2
                                <span class="text-sm text-gray-500">(‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)</span></label>
                            <input type="text" id="contestant2" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                    </div>
                </div>

                <div id="step-3" class="step hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 text-secondary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡πÇ‡∏Ñ‡πâ‡∏ä‡∏™‡∏∏‡∏î‡∏Ñ‡∏π‡∏• üë®‚Äçüè´</h2>
                    <div class="space-y-4 sm:space-y-6">
                        <div>
                            <label for="teacher1" class="block text-base sm:text-lg font-medium text-gray-800">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1
                                <span class="text-sm text-gray-500">(‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)</span></label>
                            <input type="text" id="teacher1" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="teacher2" class="block text-base sm:text-lg font-medium text-gray-800">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 2
                                <span class="text-sm text-gray-500">(‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)</span></label>
                            <input type="text" id="teacher2" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                        <div>
                            <label for="phone" class="block text-base sm:text-lg font-medium text-gray-800">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ üì±</label>
                            <input type="tel" id="phone" required
                                class="mt-2 block w-full rounded-lg sm:rounded-xl border-2 border-primary shadow-md focus:border-accent focus:ring-accent p-3 sm:p-4 text-base sm:text-lg">
                        </div>
                    </div>
                </div>

                <div id="step-4" class="step hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 text-secondary">‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å! üîç</h2>
                    <p class="mb-4 sm:mb-6 text-base sm:text-lg">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏π‡πÇ‡∏Ñ‡πâ‡∏ä‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ô‡∏∞ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢!</p>
                    <img src="https://subrkzuuirqkghijkdab.supabase.co/storage/v1/object/public/file%20klonsod/QR_klonsod.jpg"
                        alt="QR Code" class="mx-auto rounded-lg shadow-lg max-w-[200px] sm:max-w-[250px]">
                </div>

                <div id="step-5" class="step hidden">
                    <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 text-secondary">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå üìú</h2>
                    <div class="space-y-4 sm:space-y-6">
                        <div>
                            <button type="button" id="view-criteria"
                                class="w-full sm:w-auto bg-accent text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-full text-base sm:text-lg font-bold hover:bg-green-600 transition duration-300">
                                ‡∏î‡∏π‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô üéØ
                            </button>
                            <div id="pdf-viewer" class="mt-4 sm:mt-6 hidden">
                                <iframe src="https://subrkzuuirqkghijkdab.supabase.co/storage/v1/object/public/file%20klonsod/klonsod.pdf" 
                                    class="w-full h-[400px] sm:h-[600px] border-2 sm:border-4 border-dashed border-secondary rounded-xl"></iframe>
                            </div>
                        </div>
                        <div class="flex items-start sm:items-center">
                            <input type="checkbox" id="acknowledge" required
                                class="h-5 w-5 sm:h-6 sm:w-6 text-primary focus:ring-accent border-gray-300 rounded-md mt-0.5 sm:mt-0 flex-shrink-0">
                            <label for="acknowledge" class="ml-3 block text-base sm:text-lg text-gray-800">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß! üëç</label>
                        </div>
                        <div class="flex items-start sm:items-center">
                            <input type="checkbox" id="confirm" required
                                class="h-5 w-5 sm:h-6 sm:w-6 text-primary focus:ring-accent border-gray-300 rounded-md mt-0.5 sm:mt-0 flex-shrink-0">
                            <label for="confirm" class="ml-3 block text-base sm:text-lg text-gray-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢! üöÄ</label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between gap-2 sm:gap-4 mt-6 sm:mt-10">
                    <button type="button" id="prev-btn"
                        class="bg-gray-300 text-gray-800 px-4 sm:px-6 py-2.5 sm:py-3 rounded-full text-sm sm:text-lg font-bold hover:bg-gray-400 disabled:opacity-50 transition duration-300"
                        disabled>‚¨ÖÔ∏è <span class="hidden sm:inline">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</span></button>
                    <button type="button" id="next-btn"
                        class="bg-primary text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-full text-sm sm:text-lg font-bold hover:bg-pink-600 transition duration-300">
                        <span class="hidden sm:inline">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span> ‚û°Ô∏è</button>
                    <button type="submit" id="submit-btn"
                        class="bg-green-500 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-full text-sm sm:text-lg font-bold hover:bg-green-600 hidden transition duration-300">
                        ‡∏™‡πà‡∏á‡πÄ‡∏•‡∏¢! üì©</button>
                </div>
            </form>
        </div>
    </div>

    <div id="list-section" class="max-w-7xl mx-auto hidden">
        <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6 md:p-8 border-2 sm:border-4 border-dashed border-primary">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 sm:mb-8">
                <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-primary">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h1>
                <button onclick="loadRegistrations()" 
                    class="w-full sm:w-auto bg-accent text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-full font-bold hover:bg-green-600 transition duration-300 text-sm sm:text-base">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-6 mb-6 sm:mb-8">
                <div class="bg-gradient-to-br from-pink-100 to-pink-200 p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-lg">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">üë•</div>
                    <div class="text-xl sm:text-2xl font-bold text-pink-800" id="total-count">0</div>
                    <div class="text-sm sm:text-base text-gray-600">‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="bg-gradient-to-br from-blue-100 to-blue-200 p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-lg">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">üéì</div>
                    <div class="text-xl sm:text-2xl font-bold text-blue-800" id="junior-count">0</div>
                    <div class="text-sm sm:text-base text-gray-600">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô</div>
                </div>
                <div class="bg-gradient-to-br from-purple-100 to-purple-200 p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-lg">
                    <div class="text-2xl sm:text-3xl mb-1 sm:mb-2">üéØ</div>
                    <div class="text-xl sm:text-2xl font-bold text-purple-800" id="senior-count">0</div>
                    <div class="text-sm sm:text-base text-gray-600">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢</div>
                </div>
            </div>

            <div class="mb-4 sm:mb-6 flex flex-col sm:flex-row gap-3 sm:gap-4">
                <input type="text" id="search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." 
                    class="flex-1 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl border-2 border-primary focus:border-accent focus:ring-accent text-sm sm:text-lg">
                <select id="filter-level" class="px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl border-2 border-primary focus:border-accent focus:ring-accent text-sm sm:text-lg">
                    <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                    <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô</option>
                    <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢</option>
                </select>
            </div>

            <div id="loading-state" class="text-center py-8 sm:py-12 hidden">
                <div class="inline-block animate-spin rounded-full h-12 w-12 sm:h-16 sm:w-16 border-t-4 border-b-4 border-primary"></div>
                <p class="mt-4 text-lg sm:text-xl text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>

            <div id="empty-state" class="text-center py-8 sm:py-12 hidden">
                <div class="text-4xl sm:text-6xl mb-3 sm:mb-4">üìù</div>
                <p class="text-lg sm:text-2xl text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞</p>
            </div>

            <div id="table-container-desktop" class="hidden lg:block overflow-x-auto rounded-2xl shadow-lg custom-scrollbar">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-primary to-pink-400 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô 1</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô 2</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏Ñ‡∏£‡∏π 1</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏Ñ‡∏£‡∏π 2</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                            <th class="px-4 py-3 text-left font-bold text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="table-body-desktop" class="bg-white divide-y divide-gray-200">
                    </tbody>
                </table>
            </div>

            <div id="cards-container-mobile" class="lg:hidden space-y-4 hidden">
            </div>
        </div>
    </div>

    <script>
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            const icon = type === 'success' ? '‚úÖ' : 
                        type === 'error' ? '‚ùå' : 
                        type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            toast.className = `${bgColor} text-white px-3 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg flex items-center space-x-2 sm:space-x-3 toast-enter`;
            toast.innerHTML = `
                <span class="text-xl sm:text-2xl flex-shrink-0">${icon}</span>
                <span class="flex-1 text-sm sm:text-lg font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="text-white hover:text-gray-200 text-lg sm:text-xl font-bold flex-shrink-0">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function triggerConfetti() {
            const count = 200;
            const defaults = { origin: { y: 0.7 } };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }

        const supabaseClient = window.supabase.createClient(
            'https://subrkzuuirqkghijkdab.supabase.co', 
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1YnJrenV1aXJxa2doaWprZGFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1ODI1NTIsImV4cCI6MjA3MTE1ODU1Mn0.eqp2_fzlfNGnDHSdFfVUDnLuidYyNJ1kBMpgxL0UhdM'
        );

        function switchTab(tab) {
            const formSection = document.getElementById('form-section');
            const listSection = document.getElementById('list-section');
            const tabForm = document.getElementById('tab-form');
            const tabList = document.getElementById('tab-list');

            if (tab === 'form') {
                formSection.classList.remove('hidden');
                listSection.classList.add('hidden');
                tabForm.classList.add('bg-primary', 'text-white');
                tabForm.classList.remove('bg-gray-100', 'text-gray-600');
                tabList.classList.add('bg-gray-100', 'text-gray-600');
                tabList.classList.remove('bg-primary', 'text-white');
            } else {
                formSection.classList.add('hidden');
                listSection.classList.remove('hidden');
                tabList.classList.add('bg-primary', 'text-white');
                tabList.classList.remove('bg-gray-100', 'text-gray-600');
                tabForm.classList.add('bg-gray-100', 'text-gray-600');
                tabForm.classList.remove('bg-primary', 'text-white');
                loadRegistrations();
            }
        }

        let allRegistrations = [];

        async function loadRegistrations() {
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');
            const tableContainerDesktop = document.getElementById('table-container-desktop');
            const cardsContainerMobile = document.getElementById('cards-container-mobile');

            loadingState.classList.remove('hidden');
            emptyState.classList.add('hidden');
            tableContainerDesktop.classList.add('hidden');
            cardsContainerMobile.classList.add('hidden');

            try {
                const { data, error } = await supabaseClient
                    .from('registrations')
                    .select('*')
                    .order('created_at', { ascending: true });

                if (error) throw error;

                allRegistrations = data || [];
                displayRegistrations(allRegistrations);
                updateStats(allRegistrations);

            } catch (error) {
                console.error('Error loading registrations:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
                emptyState.classList.remove('hidden');
            } finally {
                loadingState.classList.add('hidden');
            }
        }

        function displayRegistrations(registrations) {
            const tableBodyDesktop = document.getElementById('table-body-desktop');
            const cardsContainerMobile = document.getElementById('cards-container-mobile');
            const emptyState = document.getElementById('empty-state');
            const tableContainerDesktop = document.getElementById('table-container-desktop');

            if (!registrations || registrations.length === 0) {
                emptyState.classList.remove('hidden');
                tableContainerDesktop.classList.add('hidden');
                cardsContainerMobile.classList.add('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            tableContainerDesktop.classList.remove('hidden');
            cardsContainerMobile.classList.remove('hidden');

            tableBodyDesktop.innerHTML = registrations.map((reg, index) => {
                const date = new Date(reg.created_at);
                const formattedDate = date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const rowColor = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                
                return `
                    <tr class="${rowColor} hover:bg-pink-50 transition-colors duration-200 fade-in">
                        <td class="px-4 py-3 font-bold text-primary text-sm">${index + 1}</td>
                        <td class="px-4 py-3 text-sm">${reg.school}</td>
                        <td class="px-4 py-3 text-sm">${reg.province}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${
                                reg.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô' 
                                    ? 'bg-blue-100 text-blue-800' 
                                    : 'bg-purple-100 text-purple-800'
                            }">
                                ${reg.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô' ? '‡∏°.‡∏ï‡πâ‡∏ô' : '‡∏°.‡∏õ‡∏•‡∏≤‡∏¢'}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">${reg.contestant1}</td>
                        <td class="px-4 py-3 text-sm">${reg.contestant2}</td>
                        <td class="px-4 py-3 text-sm">${reg.teacher1}</td>
                        <td class="px-4 py-3 text-sm">${reg.teacher2}</td>
                        <td class="px-4 py-3 text-sm">${reg.phone}</td>
                        <td class="px-4 py-3 text-sm">${reg.email}</td>
                        <td class="px-4 py-3 text-xs text-gray-600">${formattedDate}</td>
                    </tr>
                `;
            }).join('');

            cardsContainerMobile.innerHTML = registrations.map((reg, index) => {
                const date = new Date(reg.created_at);
                const formattedDate = date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="bg-white rounded-xl shadow-lg p-4 border-2 border-primary fade-in">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <span class="bg-primary text-white font-bold text-lg px-3 py-1 rounded-full">
                                    #${index + 1}
                                </span>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    reg.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô' 
                                        ? 'bg-blue-100 text-blue-800' 
                                        : 'bg-purple-100 text-purple-800'
                                }">
                                    ${reg.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô' ? '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏ï‡πâ‡∏ô' : '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="space-y-2 text-sm">
                            <div class="flex items-start">
                                <span class="font-semibold text-gray-700 min-w-[80px]">üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                                <span class="text-gray-900">${reg.school}</span>
                            </div>
                            <div class="flex items-start">
                                <span class="font-semibold text-gray-700 min-w-[80px]">üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</span>
                                <span class="text-gray-900">${reg.province}</span>
                            </div>
                            
                            <div class="border-t border-gray-200 my-2 pt-2">
                                <div class="font-semibold text-primary mb-1">üåü ‡∏ô‡∏±‡∏Å‡∏Å‡∏•‡∏≠‡∏ô</div>
                                <div class="ml-4 space-y-1">
                                    <div>1. ${reg.contestant1}</div>
                                    <div>2. ${reg.contestant2}</div>
                                </div>
                            </div>
                            
                            <div class="border-t border-gray-200 my-2 pt-2">
                                <div class="font-semibold text-secondary mb-1">üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</div>
                                <div class="ml-4 space-y-1">
                                    <div>1. ${reg.teacher1}</div>
                                    <div>2. ${reg.teacher2}</div>
                                </div>
                            </div>
                            
                            <div class="border-t border-gray-200 my-2 pt-2 space-y-1">
                                <div class="flex items-start">
                                    <span class="font-semibold text-gray-700 min-w-[80px]">üì± ‡πÇ‡∏ó‡∏£:</span>
                                    <a href="tel:${reg.phone}" class="text-blue-600">${reg.phone}</a>
                                </div>
                                <div class="flex items-start">
                                    <span class="font-semibold text-gray-700 min-w-[80px]">üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span>
                                    <a href="mailto:${reg.email}" class="text-blue-600 break-all">${reg.email}</a>
                                </div>
                            </div>
                            
                            <div class="text-xs text-gray-500 text-right pt-2 border-t border-gray-100">
                                ‚è∞ ${formattedDate}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats(registrations) {
            const totalCount = registrations.length;
            const juniorCount = registrations.filter(r => r.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô').length;
            const seniorCount = registrations.filter(r => r.level === '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢').length;

            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('junior-count').textContent = juniorCount;
            document.getElementById('senior-count').textContent = seniorCount;
        }

        document.getElementById('search-input').addEventListener('input', filterRegistrations);
        document.getElementById('filter-level').addEventListener('change', filterRegistrations);

        function filterRegistrations() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const levelFilter = document.getElementById('filter-level').value;

            let filtered = allRegistrations.filter(reg => {
                const matchesSearch = 
                    reg.school.toLowerCase().includes(searchTerm) ||
                    reg.province.toLowerCase().includes(searchTerm) ||
                    reg.contestant1.toLowerCase().includes(searchTerm) ||
                    reg.contestant2.toLowerCase().includes(searchTerm) ||
                    reg.teacher1.toLowerCase().includes(searchTerm) ||
                    reg.teacher2.toLowerCase().includes(searchTerm) ||
                    reg.email.toLowerCase().includes(searchTerm);

                const matchesLevel = !levelFilter || reg.level === levelFilter;

                return matchesSearch && matchesLevel;
            });

            displayRegistrations(filtered);
            updateStats(filtered);
        }

        const steps = document.querySelectorAll('.step');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const progressBar = document.getElementById('progress-bar');
        const form = document.getElementById('registration-form');
        let currentStep = 0;

        function showStep(step) {
            steps.forEach((s, i) => {
                s.classList.toggle('hidden', i !== step);
            });
            prevBtn.disabled = step === 0;
            if (step === steps.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
            progressBar.style.width = `${((step + 1) / steps.length) * 100}%`;
        }

        nextBtn.addEventListener('click', () => {
            if (validateStep(currentStep)) {
                currentStep++;
                showStep(currentStep);
            }
        });

        prevBtn.addEventListener('click', () => {
            currentStep--;
            showStep(currentStep);
        });

        function validateStep(step) {
            const inputs = steps[step].querySelectorAll('input[required], select[required]');
            for (let input of inputs) {
                if (!input.value.trim()) {
                    showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞! üòä', 'warning');
                    input.focus();
                    return false;
                }
            }
            return true;
        }

        document.getElementById('view-criteria').addEventListener('click', () => {
            document.getElementById('pdf-viewer').classList.toggle('hidden');
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!validateStep(currentStep)) return;

            const formData = {
                email: document.getElementById('email').value,
                school: document.getElementById('school').value,
                province: document.getElementById('province').value,
                level: document.getElementById('level').value,
                contestant1: document.getElementById('contestant1').value,
                contestant2: document.getElementById('contestant2').value,
                teacher1: document.getElementById('teacher1').value,
                teacher2: document.getElementById('teacher2').value,
                phone: document.getElementById('phone').value,
                created_at: new Date().toISOString()
            };

            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‚è≥', 'info');

            try {
                try {
                    const { data, error } = await supabaseClient.functions.invoke('register-event', {
                        body: formData
                    });

                    if (error) throw error;
                    
                    triggerConfetti();
                    showToast('üéä ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Ñ‡πà‡∏∞ üíå', 'success');
                    
                    setTimeout(() => {
                        form.reset();
                        currentStep = 0;
                        showStep(currentStep);
                    }, 2000);
                    
                } catch (functionError) {
                    console.log('Edge Function not available, using direct insert:', functionError);
                    
                    const { data, error } = await supabaseClient
                        .from('registrations')
                        .insert([formData])
                        .select();

                    if (error) throw error;

                    triggerConfetti();
                    showToast('üéä ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏Ñ‡πà‡∏∞ üíå', 'success');
                    
                    setTimeout(() => {
                        form.reset();
                        currentStep = 0;
                        showStep(currentStep);
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Error:', error);
                showToast('‡πÇ‡∏≠‡πä‡∏∞! ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢: ' + error.message + ' üòÖ', 'error');
            }
        });

        showStep(currentStep);
    </script>
</body>

</html>